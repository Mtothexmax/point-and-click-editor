import"../chunks/NZTpNUN0.js";import{i as be}from"../chunks/Ddfe8oZs.js";import{w as le,J as Te,ad as Le,aA as Ne,aB as Oe,O as je,aC as qe,aD as Be,aE as We,aF as De,e as w,K as Ue,p as xe,l as J,t as te,a as Z,m as we,W as ge,n as T,q as g,o as L,aG as ce,aH as He,Q as D,N as Q,f as $e,h as d,aI as Ze,aJ as Fe}from"../chunks/CF-fjnMp.js";import{l as ze,b as Je,w as U,e as F,g as re,s as ue,o as Ye}from"../chunks/DiRpD8Sz.js";import{s as me,a as j,i as oe,d as ae,b as Se}from"../chunks/DGVCnJ9z.js";const Ce=[...` 	
\r\fÂ \v\uFEFF`];function Xe(a,t,s){var i=""+a;if(s){for(var e in s)if(s[e])i=i?i+" "+e:e;else if(i.length)for(var n=e.length,r=0;(r=i.indexOf(e,r))>=0;){var o=r+n;(r===0||Ce.includes(i[r-1]))&&(o===i.length||Ce.includes(i[o]))?i=(r===0?"":i.substring(0,r))+i.substring(o+1):r=o}}return i===""?null:i}function ee(a,t,s,i,e,n){var r=a.__className;if(le||r!==s||r===void 0){var o=Xe(s,i,n);(!le||o!==a.getAttribute("class"))&&(o==null?a.removeAttribute("class"):a.className=o),a.__className=s}else if(n&&e!==n)for(var h in n){var S=!!n[h];(e==null||S!==!!e[h])&&a.classList.toggle(h,S)}return n}function Me(a,t,s=!1){if(a.multiple){if(t==null)return;if(!Le(t))return Ne();for(var i of a.options)i.selected=t.includes(se(i));return}for(i of a.options){var e=se(i);if(Oe(e,t)){i.selected=!0;return}}(!s||t!==void 0)&&(a.selectedIndex=-1)}function Ge(a){var t=new MutationObserver(()=>{Me(a,a.__value)});t.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),je(()=>{t.disconnect()})}function Ke(a,t,s=t){var i=!0;ze(a,"change",e=>{var n=e?"[selected]":":checked",r;if(a.multiple)r=[].map.call(a.querySelectorAll(n),se);else{var o=a.querySelector(n)??a.querySelector("option:not([disabled])");r=o&&se(o)}s(r)}),Te(()=>{var e=t();if(Me(a,e,i),i&&e===void 0){var n=a.querySelector(":checked");n!==null&&(e=se(n),s(e))}a.__value=e,i=!1}),Ge(a)}function se(a){return"__value"in a?a.__value:a.value}const Ve=Symbol("is custom element"),Qe=Symbol("is html");function he(a){if(le){var t=!1,s=()=>{if(!t){if(t=!0,a.hasAttribute("value")){var i=a.value;Ie(a,"value",null),a.value=i}if(a.hasAttribute("checked")){var e=a.checked;Ie(a,"checked",null),a.checked=e}}};a.__on_r=s,qe(s),Je()}}function Ie(a,t,s,i){var e=Re(a);le&&(e[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||e[t]!==(e[t]=s)&&(t==="loading"&&(a[Be]=s),a.removeAttribute(t))}function Re(a){return a.__attributes??={[Ve]:a.nodeName.includes("-"),[Qe]:a.namespaceURI===We}}function fe(a,t,s=t){var i=De();ze(a,"input",e=>{var n=e?a.defaultValue:a.value;if(n=ve(a)?pe(n):n,s(n),i&&n!==(n=t())){var r=a.selectionStart,o=a.selectionEnd;a.value=n??"",o!==null&&(a.selectionStart=r,a.selectionEnd=Math.min(o,a.value.length))}}),(le&&a.defaultValue!==a.value||w(t)==null&&a.value)&&s(ve(a)?pe(a.value):a.value),Ue(()=>{var e=t();ve(a)&&e===pe(a.value)||a.type==="date"&&!e&&!a.value||e!==a.value&&(a.value=e??"")})}function ve(a){var t=a.type;return t==="number"||t==="range"}function pe(a){return a===""?null:+a}const q=U(null),de=U([]),ie=U([]),ne=U([]),ye=U(null),_e=U("select"),G=U(null),K=U(null),R=U([]),V=U(null);var et=J('<div class="toolbar svelte-16pg9je"><button title="Load Background Image" class="svelte-16pg9je"><i class="material-icons">photo</i> <span>Load BG</span></button> <button title="Select"><i class="material-icons">touch_app</i> <span>Select</span></button> <button title="Create Walkable Area"><i class="material-icons">timeline</i> <span>Walkable</span></button> <button title="Create Z-Index Area"><i class="material-icons">layers</i> <span>Z-Index</span></button> <button title="Create Interaction Area"><i class="material-icons">interests</i> <span>Interaction</span></button> <button title="Create Character Point"><i class="material-icons">person_add</i> <span>Character</span></button> <button title="Export JSON" class="svelte-16pg9je"><i class="material-icons">save</i> <span>Export</span></button></div>');function tt(a,t){xe(t,!1);const[s,i]=me(),e=()=>j(_e,"$tool",s);function n(A){_e.set(A)}function r(){const A=document.createElement("input");A.type="file",A.accept="image/png",A.onchange=B=>{const N=B.target.files[0];if(!N)return;const I=new FileReader;I.onload=H=>{const P=new Image;P.onload=()=>{ye.set(P)},P.src=H.target.result},I.readAsDataURL(N)},A.click()}function o(){const A={walkable_areas:re(de).map(P=>({points:P.points})),z_index_areas:re(ie).map(P=>({points:P.points,z_index:P.zIndex})),interaction_areas:re(R).map(P=>({points:P.points,name:P.name,interaction_type:P.interactionType})),character_points:re(ne)},B=JSON.stringify({scene:A},null,2),N=new Blob([B],{type:"application/json"}),I=URL.createObjectURL(N),H=document.createElement("a");H.href=I,H.download="scene.json",document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(I)}be();var h=et(),S=T(h),k=g(S,2);let z;var C=g(k,2);let y;var v=g(C,2);let m;var W=g(v,2);let p;var M=g(W,2);let f;var X=g(M,2);L(h),te((A,B,N,I,H)=>{z=ee(k,1,"svelte-16pg9je",null,z,A),y=ee(C,1,"svelte-16pg9je",null,y,B),m=ee(v,1,"svelte-16pg9je",null,m,N),p=ee(W,1,"svelte-16pg9je",null,p,I),f=ee(M,1,"svelte-16pg9je",null,f,H)},[()=>({active:e()==="select"}),()=>({active:e()==="walkable"}),()=>({active:e()==="zindex"}),()=>({active:e()==="interaction"}),()=>({active:e()==="character"})],ge),F("click",S,r),F("click",k,()=>n("select")),F("click",C,()=>n("walkable")),F("click",v,()=>n("zindex")),F("click",W,()=>n("interaction")),F("click",M,()=>n("character")),F("click",X,o),Z(a,h),we(),i()}var at=J('<label class="svelte-10x0sde">Z-Index: <input type="range" min="0" max="1" step="0.01" class="svelte-10x0sde"/> <span class="svelte-10x0sde"> </span></label>'),st=J('<label class="svelte-10x0sde">Name: <input type="text"/></label> <label class="svelte-10x0sde">Interaction Type: <select><option>Interaction</option><option>Scene Change</option></select></label>',1),it=J('<label class="svelte-10x0sde">Relative Height: <input type="range" min="0.01" max="1" step="0.01" class="svelte-10x0sde"/> <span class="svelte-10x0sde"> </span></label>'),nt=J('<h2 class="svelte-10x0sde">Properties</h2> <p class="svelte-10x0sde"> </p> <!> <!> <!>',1),lt=J('<p class="svelte-10x0sde">No object selected</p>'),rt=J('<div class="properties-panel svelte-10x0sde"><!></div>');function ot(a,t){xe(t,!1);const[s,i]=me(),e=()=>j(q,"$selectedObject",s);let n=Q(),r=Q(.1),o=Q(""),h=Q("interaction");function S(){e()&&e().type==="zindex"&&(ae(q,w(e).zIndex=d(n),w(e)),ie.update(p=>[...p]))}function k(){e()&&e().type==="character"&&(ae(q,w(e).relativeHeight=d(r),w(e)),ne.update(p=>[...p]))}function z(){e()&&e().type==="interaction"&&(ae(q,w(e).name=d(o),w(e)),R.update(p=>[...p]))}function C(){e()&&e().type==="interaction"&&(ae(q,w(e).interactionType=d(h),w(e)),R.update(p=>[...p]))}ce(()=>e(),()=>{e()&&e().type==="zindex"&&D(n,e().zIndex)}),ce(()=>e(),()=>{e()&&e().type==="character"&&D(r,e().relativeHeight)}),ce(()=>e(),()=>{e()&&e().type==="interaction"&&(D(o,e().name),D(h,e().interactionType))}),He(),be();var y=rt(),v=T(y);{var m=p=>{var M=nt(),f=g($e(M),2),X=T(f);L(f);var A=g(f,2);{var B=E=>{var O=at(),$=g(T(O));he($);var b=g($,2),Y=T(b,!0);L(b),L(O),te(l=>ue(Y,l),[()=>(d(n),w(()=>d(n).toFixed(2)))],ge),fe($,()=>d(n),l=>D(n,l)),F("input",$,S),Z(E,O)};oe(A,E=>{e(),w(()=>e().type==="zindex")&&E(B)})}var N=g(A,2);{var I=E=>{var O=st(),$=$e(O),b=g(T($));he(b),L($);var Y=g($,2),l=g(T(Y));te(()=>{d(h),Ze(()=>{})});var u=T(l);u.value=u.__value="interaction";var c=g(u);c.value=c.__value="scene_change",L(l),L(Y),fe(b,()=>d(o),x=>D(o,x)),F("input",b,z),Ke(l,()=>d(h),x=>D(h,x)),F("change",l,C),Z(E,O)};oe(N,E=>{e(),w(()=>e().type==="interaction")&&E(I)})}var H=g(N,2);{var P=E=>{var O=it(),$=g(T(O));he($);var b=g($,2),Y=T(b,!0);L(b),L(O),te(l=>ue(Y,l),[()=>(d(r),w(()=>d(r).toFixed(2)))],ge),fe($,()=>d(r),l=>D(r,l)),F("input",$,k),Z(E,O)};oe(H,E=>{e(),w(()=>e().type==="character")&&E(P)})}te(()=>ue(X,`Type: ${e(),w(()=>e().type)??""}`)),Z(p,M)},W=p=>{var M=lt();Z(p,M)};oe(v,p=>{e()?p(m):p(W,!1)})}L(y),Z(a,y),we(),i()}class Ee{constructor(){this.id=Date.now()+Math.random(),this.selected=!1,this.type="drawable"}move(t,s){}draw(t){}isPointInside(t){return!1}}class Pe extends Ee{constructor(t=[]){super(),this.points=t,this.fillColor="rgba(0, 255, 0, 0.5)",this.lineColor="#00FF00",this.type="polygon"}addPoint(t){this.points.push(t)}move(t,s,i){const e=t/i.width,n=s/i.height;this.points=this.points.map(r=>({x:r.x+e,y:r.y+n}))}isPointInside(t,s){let i=!1;for(let e=0,n=this.points.length-1;e<this.points.length;n=e++){const r=this.points[e].x*s.width+s.x,o=this.points[e].y*s.height+s.y,h=this.points[n].x*s.width+s.x,S=this.points[n].y*s.height+s.y;o>t.y!=S>t.y&&t.x<(h-r)*(t.y-o)/(S-o)+r&&(i=!i)}return i}getCenter(){if(this.points.length===0)return null;const t=this.points.reduce((s,i)=>({x:s.x+i.x,y:s.y+i.y}),{x:0,y:0});return{x:t.x/this.points.length,y:t.y/this.points.length}}draw(t,s,i=!1){if(this.points.length===0)return;const e=this.points.map(n=>({x:n.x*s.width+s.x,y:n.y*s.height+s.y}));t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);this.points.length>2&&t.closePath(),this.points.length>2&&(t.fillStyle=this.fillColor,t.fill()),t.strokeStyle=this.lineColor,t.lineWidth=1,t.stroke(),this.selected&&(t.strokeStyle="#FFFF00",t.lineWidth=2,t.stroke()),(this.selected||i)&&e.forEach(n=>{t.beginPath(),t.arc(n.x,n.y,5,0,2*Math.PI),t.fillStyle="#FFFF00",t.fill()})}}class ct extends Pe{constructor(t=[]){super(t),this.type="walkable"}}class dt extends Pe{constructor(t=[]){super(t),this.zIndex=1,this.fillColor="rgba(0, 0, 255, 0.5)",this.lineColor="#0000FF",this.type="zindex"}draw(t,s,i=!1){if(super.draw(t,s,i),this.points.length>0){const e=this.points.map(o=>({x:o.x*s.width+s.x,y:o.y*s.height+s.y}));let n=e.reduce((o,h)=>o+h.x,0)/e.length,r=e.reduce((o,h)=>o+h.y,0)/e.length;t.fillStyle="#FFFFFF",t.font="16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.zIndex.toFixed(2),n,r)}}}class ut extends Pe{constructor(t=[]){super(t),this.type="interaction",this.name="default_name",this.interactionType="interaction",this.fillColor="rgba(255, 165, 0, 0.5)",this.lineColor="#FFA500"}draw(t,s,i=!1){if(super.draw(t,s,i),this.points.length>2){const e=this.getCenter();if(e){const n={x:e.x*s.width+s.x,y:e.y*s.height+s.y};t.fillStyle="#000000",t.font="16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.name,n.x,n.y)}}}}class ht extends Ee{constructor(t){super(),this.basePoint=t,this.relativeHeight=.1,this.type="character",this.characterImage=new Image,this.characterImage.src="/character.svg",this.isDraggingHandle=!1}move(t,s,i){const e=t/i.width,n=s/i.height;this.basePoint.x+=e,this.basePoint.y+=n}moveHeight(t,s){const i=t/s.height;this.relativeHeight-=i,this.relativeHeight=Math.max(.01,this.relativeHeight)}isPointInside(t,s){const i={x:this.basePoint.x*s.width+s.x,y:this.basePoint.y*s.height+s.y};return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))<10}isPointInsideHandle(t,s){const i={x:this.basePoint.x*s.width+s.x,y:this.basePoint.y*s.height+s.y},e=this.relativeHeight*s.height,n={x:i.x,y:i.y-e};return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<10}draw(t,s){const i={x:this.basePoint.x*s.width+s.x,y:this.basePoint.y*s.height+s.y},e=this.relativeHeight*s.height,n=this.characterImage.width/this.characterImage.height,r=e*n,o=i.x-r/2,h=i.y-e;t.drawImage(this.characterImage,o,h,r,e),t.fillStyle="red",t.beginPath(),t.arc(i.x,i.y,5,0,Math.PI*2),t.fill(),t.fillStyle="blue",t.beginPath(),t.arc(i.x,h,5,0,Math.PI*2),t.fill(),this.selected&&(t.strokeStyle="#FFFF00",t.lineWidth=2,t.strokeRect(o,h,r,e))}toJSON(){return{basePoint:this.basePoint,relativeHeight:this.relativeHeight}}}var ft=J('<div class="canvas-container svelte-14wctm0" tabindex="0"><canvas class="svelte-14wctm0"></canvas></div>');function vt(a,t){xe(t,!1);const[s,i]=me(),e=()=>j(_e,"$tool",s),n=()=>j(ye,"$backgroundImage",s),r=()=>j(de,"$walkableAreas",s),o=()=>j(ie,"$zIndexAreas",s),h=()=>j(R,"$interactionAreas",s),S=()=>j(ne,"$characterPoints",s),k=()=>j(G,"$draftWalkableArea",s),z=()=>j(K,"$draftZIndexArea",s),C=()=>j(V,"$draftInteractionArea",s),y=()=>j(q,"$selectedObject",s);let v=Q(),m,W=Q(),p=!1,M={x:0,y:0},f={x:0,y:0,width:0,height:0};Ye(()=>{m=d(v).getContext("2d"),X(),window.addEventListener("resize",X);const l=new Image;return l.src="/example_background.png",l.onload=()=>{ye.set(l)},B(),()=>{window.removeEventListener("resize",X)}});function X(){Fe(v,d(v).width=d(W).clientWidth),Fe(v,d(v).height=d(W).clientHeight),B()}function A(){if(!n())return;const l=n(),u=d(v).width/d(v).height,c=l.width/l.height;let x,_,ke,Ae;u>c?(_=d(v).height*.9,x=_*c):(x=d(v).width*.9,_=x/c),ke=(d(v).width-x)/2,Ae=(d(v).height-_)/2,f={x:ke,y:Ae,width:x,height:_}}function B(){m&&(m.clearRect(0,0,d(v).width,d(v).height),A(),n()&&m.drawImage(n(),f.x,f.y,f.width,f.height),r().forEach(l=>l.draw(m,f)),o().forEach(l=>l.draw(m,f)),h().forEach(l=>l.draw(m,f)),S().forEach(l=>l.draw(m,f)),k()&&k().draw(m,f,!0),z()&&z().draw(m,f,!0),C()&&C().draw(m,f,!0),requestAnimationFrame(B))}function N(l){const u=d(v).getBoundingClientRect();return{x:l.clientX-u.left,y:l.clientY-u.top}}function I(l){return{x:(l.x-f.x)/f.width,y:(l.y-f.y)/f.height}}function H(){k()&&(de.update(l=>[...l,k()]),G.set(null)),z()&&(ie.update(l=>[...l,z()]),K.set(null)),C()&&(R.update(l=>[...l,C()]),V.set(null))}function P(l){const u=N(l);if(M=u,l.button!==2){if(e()==="select"){let c=!1,x=!1;S().forEach(_=>{_.isPointInsideHandle(u,f)?(q.set(_),_.selected=!0,_.isDraggingHandle=!0,c=!0,x=!0):(_.selected=!1,_.isDraggingHandle=!1)}),x||[...r(),...o(),...h(),...S()].forEach(_=>{_.isPointInside(u,f)?(q.set(_),_.selected=!0,c=!0):_.selected=!1}),c||q.set(null),p=y()!==null;return}if(e()==="character"){G.set(null),K.set(null),V.set(null);const c=I(u),x=new ht(c);ne.update(_=>[..._,x]),q.set(x);return}if(e()==="walkable"){z()&&K.set(null),C()&&V.set(null);const c=I(u);k()?k().addPoint(c):G.set(new ct([c]))}else if(e()==="zindex"){k()&&G.set(null),C()&&V.set(null);const c=I(u);z()?z().addPoint(c):K.set(new dt([c]))}else if(e()==="interaction"){k()&&G.set(null),z()&&K.set(null);const c=I(u);C()?C().addPoint(c):V.set(new ut([c]))}}}function E(l){if(!p||!y())return;const u=N(l),c=u.x-M.x,x=u.y-M.y;y().move(c,x,f),M=u}function O(l){p=!1,y()&&y().type==="character"&&ae(q,w(y).isDraggingHandle=!1,w(y))}function $(l){l.key==="Enter"?H():l.key==="Escape"?e()==="walkable"?G.set(null):e()==="zindex"?K.set(null):e()==="interaction"&&V.set(null):l.key==="Delete"&&y()&&(de.update(u=>u.filter(c=>c.id!==y().id)),ie.update(u=>u.filter(c=>c.id!==y().id)),R.update(u=>u.filter(c=>c.id!==y().id)),ne.update(u=>u.filter(c=>c.id!==y().id)),q.set(null))}ce(()=>e(),()=>{e(),H()}),He(),be();var b=ft(),Y=T(b);Se(Y,l=>D(v,l),()=>d(v)),L(b),Se(b,l=>D(W,l),()=>d(W)),F("mousedown",b,P),F("mousemove",b,E),F("mouseup",b,O),F("keydown",b,$),Z(a,b),we(),i()}var pt=J('<main class="svelte-12lzxqp"><!> <div class="content svelte-12lzxqp"><!> <!></div></main>');function wt(a){var t=pt(),s=T(t);tt(s,{});var i=g(s,2),e=T(i);vt(e,{});var n=g(e,2);ot(n,{}),L(i),L(t),Z(a,t)}export{wt as component};
