import"../chunks/NZTpNUN0.js";import{i as be}from"../chunks/Ddfe8oZs.js";import{w as le,J as $e,ad as He,aA as Fe,aB as je,O as Oe,aC as Qe,aD as Le,aE as Be,aF as Ze,e as w,K as We,p as _e,l as J,t as te,a as q,m as we,W as pe,n as $,q as p,o as H,aG as ce,aH as Ne,Q as Z,N as V,f as De,h as d,aI as qe,aJ as Ee}from"../chunks/CF-fjnMp.js";import{l as ze,b as Je,w as W,e as E,g as re,s as ue,o as Ue}from"../chunks/DiRpD8Sz.js";import{s as Ie,a as O,i as oe,d as ae,b as Pe}from"../chunks/DGVCnJ9z.js";const ke=[...` 	
\r\fÂ \v\uFEFF`];function Ye(a,t,s){var i=""+a;if(s){for(var e in s)if(s[e])i=i?i+" "+e:e;else if(i.length)for(var n=e.length,r=0;(r=i.indexOf(e,r))>=0;){var o=r+n;(r===0||ke.includes(i[r-1]))&&(o===i.length||ke.includes(i[o]))?i=(r===0?"":i.substring(0,r))+i.substring(o+1):r=o}}return i===""?null:i}function ee(a,t,s,i,e,n){var r=a.__className;if(le||r!==s||r===void 0){var o=Ye(s,i,n);(!le||o!==a.getAttribute("class"))&&(o==null?a.removeAttribute("class"):a.className=o),a.__className=s}else if(n&&e!==n)for(var h in n){var P=!!n[h];(e==null||P!==!!e[h])&&a.classList.toggle(h,P)}return n}function Se(a,t,s=!1){if(a.multiple){if(t==null)return;if(!He(t))return Fe();for(var i of a.options)i.selected=t.includes(se(i));return}for(i of a.options){var e=se(i);if(je(e,t)){i.selected=!0;return}}(!s||t!==void 0)&&(a.selectedIndex=-1)}function Ge(a){var t=new MutationObserver(()=>{Se(a,a.__value)});t.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Oe(()=>{t.disconnect()})}function Xe(a,t,s=t){var i=!0;ze(a,"change",e=>{var n=e?"[selected]":":checked",r;if(a.multiple)r=[].map.call(a.querySelectorAll(n),se);else{var o=a.querySelector(n)??a.querySelector("option:not([disabled])");r=o&&se(o)}s(r)}),$e(()=>{var e=t();if(Se(a,e,i),i&&e===void 0){var n=a.querySelector(":checked");n!==null&&(e=se(n),s(e))}a.__value=e,i=!1}),Ge(a)}function se(a){return"__value"in a?a.__value:a.value}const Ke=Symbol("is custom element"),Ve=Symbol("is html");function he(a){if(le){var t=!1,s=()=>{if(!t){if(t=!0,a.hasAttribute("value")){var i=a.value;Te(a,"value",null),a.value=i}if(a.hasAttribute("checked")){var e=a.checked;Te(a,"checked",null),a.checked=e}}};a.__on_r=s,Qe(s),Je()}}function Te(a,t,s,i){var e=Re(a);le&&(e[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||e[t]!==(e[t]=s)&&(t==="loading"&&(a[Le]=s),a.removeAttribute(t))}function Re(a){return a.__attributes??={[Ke]:a.nodeName.includes("-"),[Ve]:a.namespaceURI===Be}}function fe(a,t,s=t){var i=Ze();ze(a,"input",e=>{var n=e?a.defaultValue:a.value;if(n=ve(a)?ge(n):n,s(n),i&&n!==(n=t())){var r=a.selectionStart,o=a.selectionEnd;a.value=n??"",o!==null&&(a.selectionStart=r,a.selectionEnd=Math.min(o,a.value.length))}}),(le&&a.defaultValue!==a.value||w(t)==null&&a.value)&&s(ve(a)?ge(a.value):a.value),We(()=>{var e=t();ve(a)&&e===ge(a.value)||a.type==="date"&&!e&&!a.value||e!==a.value&&(a.value=e??"")})}function ve(a){var t=a.type;return t==="number"||t==="range"}function ge(a){return a===""?null:+a}const Q=W(null),de=W([]),ie=W([]),ne=W([]),ye=W(null),xe=W("select"),G=W(null),X=W(null),R=W([]),K=W(null);var et=J('<div class="toolbar svelte-16pg9je"><button title="Load Background Image" class="svelte-16pg9je"><i class="material-icons">photo</i> <span>Load BG</span></button> <button title="Select"><i class="material-icons">touch_app</i> <span>Select</span></button> <button title="Create Walkable Area"><i class="material-icons">timeline</i> <span>Walkable</span></button> <button title="Create Z-Index Area"><i class="material-icons">layers</i> <span>Z-Index</span></button> <button title="Create Interaction Area"><i class="material-icons">interests</i> <span>Interaction</span></button> <button title="Create Character Point"><i class="material-icons">person_add</i> <span>Character</span></button> <button title="Export JSON" class="svelte-16pg9je"><i class="material-icons">save</i> <span>Export</span></button></div>');function tt(a,t){_e(t,!1);const[s,i]=Ie(),e=()=>O(xe,"$tool",s);function n(A){xe.set(A)}function r(){const A=document.createElement("input");A.type="file",A.accept="image/png",A.onchange=L=>{const F=L.target.files[0];if(!F)return;const T=new FileReader;T.onload=N=>{const M=new Image;M.onload=()=>{ye.set(M)},M.src=N.target.result},T.readAsDataURL(F)},A.click()}function o(){const A={walkable_areas:re(de).map(M=>({points:M.points})),z_index_areas:re(ie).map(M=>({points:M.points,z_index:M.zIndex})),interaction_areas:re(R).map(M=>({points:M.points,name:M.name,interaction_type:M.interactionType})),character_points:re(ne)},L=JSON.stringify({scene:A},null,2),F=new Blob([L],{type:"application/json"}),T=URL.createObjectURL(F),N=document.createElement("a");N.href=T,N.download="scene.json",document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(T)}be();var h=et(),P=$(h),m=p(P,2);let z;var k=p(m,2);let y;var v=p(k,2);let I;var B=p(v,2);let g;var S=p(B,2);let f;var Y=p(S,2);H(h),te((A,L,F,T,N)=>{z=ee(m,1,"svelte-16pg9je",null,z,A),y=ee(k,1,"svelte-16pg9je",null,y,L),I=ee(v,1,"svelte-16pg9je",null,I,F),g=ee(B,1,"svelte-16pg9je",null,g,T),f=ee(S,1,"svelte-16pg9je",null,f,N)},[()=>({active:e()==="select"}),()=>({active:e()==="walkable"}),()=>({active:e()==="zindex"}),()=>({active:e()==="interaction"}),()=>({active:e()==="character"})],pe),E("click",P,r),E("click",m,()=>n("select")),E("click",k,()=>n("walkable")),E("click",v,()=>n("zindex")),E("click",B,()=>n("interaction")),E("click",S,()=>n("character")),E("click",Y,o),q(a,h),we(),i()}var at=J('<label class="svelte-10x0sde">Z-Index: <input type="range" min="0" max="1" step="0.01" class="svelte-10x0sde"/> <span class="svelte-10x0sde"> </span></label>'),st=J('<label class="svelte-10x0sde">Name: <input type="text"/></label> <label class="svelte-10x0sde">Interaction Type: <select><option>Interaction</option><option>Scene Change</option></select></label>',1),it=J('<label class="svelte-10x0sde">Relative Height: <input type="range" min="0.01" max="1" step="0.01" class="svelte-10x0sde"/> <span class="svelte-10x0sde"> </span></label>'),nt=J('<h2 class="svelte-10x0sde">Properties</h2> <p class="svelte-10x0sde"> </p> <!> <!> <!>',1),lt=J('<p class="svelte-10x0sde">No object selected</p>'),rt=J('<div class="properties-panel svelte-10x0sde"><!></div>');function ot(a,t){_e(t,!1);const[s,i]=Ie(),e=()=>O(Q,"$selectedObject",s);let n=V(),r=V(.1),o=V(""),h=V("interaction");function P(){e()&&e().type==="zindex"&&(ae(Q,w(e).zIndex=d(n),w(e)),ie.update(g=>[...g]))}function m(){e()&&e().type==="character"&&(ae(Q,w(e).relativeHeight=d(r),w(e)),ne.update(g=>[...g]))}function z(){e()&&e().type==="interaction"&&(ae(Q,w(e).name=d(o),w(e)),R.update(g=>[...g]))}function k(){e()&&e().type==="interaction"&&(ae(Q,w(e).interactionType=d(h),w(e)),R.update(g=>[...g]))}ce(()=>e(),()=>{e()&&e().type==="zindex"&&Z(n,e().zIndex)}),ce(()=>e(),()=>{e()&&e().type==="character"&&Z(r,e().relativeHeight)}),ce(()=>e(),()=>{e()&&e().type==="interaction"&&(Z(o,e().name),Z(h,e().interactionType))}),Ne(),be();var y=rt(),v=$(y);{var I=g=>{var S=nt(),f=p(De(S),2),Y=$(f);H(f);var A=p(f,2);{var L=C=>{var j=at(),D=p($(j));he(D);var b=p(D,2),U=$(b,!0);H(b),H(j),te(l=>ue(U,l),[()=>(d(n),w(()=>d(n).toFixed(2)))],pe),fe(D,()=>d(n),l=>Z(n,l)),E("input",D,P),q(C,j)};oe(A,C=>{e(),w(()=>e().type==="zindex")&&C(L)})}var F=p(A,2);{var T=C=>{var j=st(),D=De(j),b=p($(D));he(b),H(D);var U=p(D,2),l=p($(U));te(()=>{d(h),qe(()=>{})});var u=$(l);u.value=u.__value="interaction";var c=p(u);c.value=c.__value="scene_change",H(l),H(U),fe(b,()=>d(o),_=>Z(o,_)),E("input",b,z),Xe(l,()=>d(h),_=>Z(h,_)),E("change",l,k),q(C,j)};oe(F,C=>{e(),w(()=>e().type==="interaction")&&C(T)})}var N=p(F,2);{var M=C=>{var j=it(),D=p($(j));he(D);var b=p(D,2),U=$(b,!0);H(b),H(j),te(l=>ue(U,l),[()=>(d(r),w(()=>d(r).toFixed(2)))],pe),fe(D,()=>d(r),l=>Z(r,l)),E("input",D,m),q(C,j)};oe(N,C=>{e(),w(()=>e().type==="character")&&C(M)})}te(()=>ue(Y,`Type: ${e(),w(()=>e().type)??""}`)),q(g,S)},B=g=>{var S=lt();q(g,S)};oe(v,g=>{e()?g(I):g(B,!1)})}H(y),q(a,y),we(),i()}class Ce{constructor(){this.id=Date.now()+Math.random(),this.selected=!1,this.type="drawable"}move(t,s){}draw(t){}isPointInside(t){return!1}}class Me extends Ce{constructor(t=[]){super(),this.points=t,this.fillColor="rgba(0, 255, 0, 0.5)",this.lineColor="#00FF00",this.type="polygon"}addPoint(t){this.points.push(t)}move(t,s,i){const e=t/i.width,n=s/i.height;this.points=this.points.map(r=>({x:r.x+e,y:r.y+n}))}isPointInside(t,s){let i=!1;for(let e=0,n=this.points.length-1;e<this.points.length;n=e++){const r=this.points[e].x*s.width+s.x,o=this.points[e].y*s.height+s.y,h=this.points[n].x*s.width+s.x,P=this.points[n].y*s.height+s.y;o>t.y!=P>t.y&&t.x<(h-r)*(t.y-o)/(P-o)+r&&(i=!i)}return i}getCenter(){if(this.points.length===0)return null;const t=this.points.reduce((s,i)=>({x:s.x+i.x,y:s.y+i.y}),{x:0,y:0});return{x:t.x/this.points.length,y:t.y/this.points.length}}draw(t,s,i=!1){if(this.points.length===0)return;const e=this.points.map(n=>({x:n.x*s.width+s.x,y:n.y*s.height+s.y}));t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);this.points.length>2&&t.closePath(),this.points.length>2&&(t.fillStyle=this.fillColor,t.fill()),t.strokeStyle=this.lineColor,t.lineWidth=1,t.stroke(),this.selected&&(t.strokeStyle="#FFFF00",t.lineWidth=2,t.stroke()),(this.selected||i)&&e.forEach(n=>{t.beginPath(),t.arc(n.x,n.y,5,0,2*Math.PI),t.fillStyle="#FFFF00",t.fill()})}}class ct extends Me{constructor(t=[]){super(t),this.type="walkable"}}class dt extends Me{constructor(t=[]){super(t),this.zIndex=1,this.fillColor="rgba(0, 0, 255, 0.5)",this.lineColor="#0000FF",this.type="zindex"}draw(t,s,i=!1){if(super.draw(t,s,i),this.points.length>0){const e=this.points.map(o=>({x:o.x*s.width+s.x,y:o.y*s.height+s.y}));let n=e.reduce((o,h)=>o+h.x,0)/e.length,r=e.reduce((o,h)=>o+h.y,0)/e.length;t.fillStyle="#FFFFFF",t.font="16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.zIndex.toFixed(2),n,r)}}}class ut extends Me{constructor(t=[]){super(t),this.type="interaction",this.name="default_name",this.interactionType="interaction",this.fillColor="rgba(255, 165, 0, 0.5)",this.lineColor="#FFA500"}draw(t,s,i=!1){if(super.draw(t,s,i),this.points.length>2){const e=this.getCenter();if(e){const n={x:e.x*s.width+s.x,y:e.y*s.height+s.y};t.fillStyle="#000000",t.font="16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.name,n.x,n.y)}}}}class ht extends Ce{constructor(t){super(),this.basePoint=t,this.relativeHeight=.1,this.type="character",this.characterImage=new Image,this.characterImage.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDNjQ4IDIgMiA2NDggMiAxMkMyIDE3NTIgNjQ4IDIyIDEyIDIyQTE3NTIgMjIgMjIgMTc1MiAyMiAxMkMyMiA2NDggMTc1MiAyIDEyIDJNMTEyIDRDMTY0MSA0IDIwIDc1OSAyMCAxMkMyMCAxNjQxIDE2NDEgMjAgMTIgMjBDNzU5IDIwIDQgMTY0MSA0IDEyQzQgNzU5IDc1OSAzIDEyIDNNMTIgNkM5NzkgNiA4IDc3OSA4IDEwQzggMTIyMSA5NzkgMTQgMTIgMTRDMTQyMSAxNCAxNiAxMjIxIDE2IDEwQzE2IDc3OSAxNDIxIDYgMTIgNk0xMiA4QzEzMS44IDE0IDg5IDE0IDEwQzE0IDExMSAxMzEgMTIgMTIgMTJDMTB5IDEyIDEwIDExMSAxMCAxMEMxMCA4OSAxMDkgOCAxMiA4TTEyIDE2QzEzMyAxNiA0IDE3MzQgNCAyMEg2QzYgMTgzNCA5MzMgMTcgMTIgMTdDMTQ2NyAxNyAxOCAxODM0IDE4IDIwSDIwQzIwIDE3MzQgMTQ2NyAxNiAxMiAxNloiIGZpbGw9ImN1cnJlbnRDb2xvciIvPgo8L3N2Zz4=",this.isDraggingHandle=!1}move(t,s,i){const e=t/i.width,n=s/i.height;this.basePoint.x+=e,this.basePoint.y+=n}moveHeight(t,s){const i=t/s.height;this.relativeHeight-=i,this.relativeHeight=Math.max(.01,this.relativeHeight)}isPointInside(t,s){const i={x:this.basePoint.x*s.width+s.x,y:this.basePoint.y*s.height+s.y};return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))<10}isPointInsideHandle(t,s){const i={x:this.basePoint.x*s.width+s.x,y:this.basePoint.y*s.height+s.y},e=this.relativeHeight*s.height,n={x:i.x,y:i.y-e};return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<10}draw(t,s){const i={x:this.basePoint.x*s.width+s.x,y:this.basePoint.y*s.height+s.y},e=this.relativeHeight*s.height,n=this.characterImage.width/this.characterImage.height,r=e*n,o=i.x-r/2,h=i.y-e;t.drawImage(this.characterImage,o,h,r,e),t.fillStyle="red",t.beginPath(),t.arc(i.x,i.y,5,0,Math.PI*2),t.fill(),t.fillStyle="blue",t.beginPath(),t.arc(i.x,h,5,0,Math.PI*2),t.fill(),this.selected&&(t.strokeStyle="#FFFF00",t.lineWidth=2,t.strokeRect(o,h,r,e))}toJSON(){return{basePoint:this.basePoint,relativeHeight:this.relativeHeight}}}var ft=J('<div class="canvas-container svelte-14wctm0" tabindex="0"><canvas class="svelte-14wctm0"></canvas></div>');function vt(a,t){_e(t,!1);const[s,i]=Ie(),e=()=>O(xe,"$tool",s),n=()=>O(ye,"$backgroundImage",s),r=()=>O(de,"$walkableAreas",s),o=()=>O(ie,"$zIndexAreas",s),h=()=>O(R,"$interactionAreas",s),P=()=>O(ne,"$characterPoints",s),m=()=>O(G,"$draftWalkableArea",s),z=()=>O(X,"$draftZIndexArea",s),k=()=>O(K,"$draftInteractionArea",s),y=()=>O(Q,"$selectedObject",s);let v=V(),I,B=V(),g=!1,S={x:0,y:0},f={x:0,y:0,width:0,height:0};Ue(()=>{I=d(v).getContext("2d"),Y(),window.addEventListener("resize",Y);const l=new Image;return l.src="/example_background.png",l.onload=()=>{ye.set(l)},L(),()=>{window.removeEventListener("resize",Y)}});function Y(){Ee(v,d(v).width=d(B).clientWidth),Ee(v,d(v).height=d(B).clientHeight),L()}function A(){if(!n())return;const l=n(),u=d(v).width/d(v).height,c=l.width/l.height;let _,x,me,Ae;u>c?(x=d(v).height*.9,_=x*c):(_=d(v).width*.9,x=_/c),me=(d(v).width-_)/2,Ae=(d(v).height-x)/2,f={x:me,y:Ae,width:_,height:x}}function L(){I&&(I.clearRect(0,0,d(v).width,d(v).height),A(),n()&&I.drawImage(n(),f.x,f.y,f.width,f.height),r().forEach(l=>l.draw(I,f)),o().forEach(l=>l.draw(I,f)),h().forEach(l=>l.draw(I,f)),P().forEach(l=>l.draw(I,f)),m()&&m().draw(I,f,!0),z()&&z().draw(I,f,!0),k()&&k().draw(I,f,!0),requestAnimationFrame(L))}function F(l){const u=d(v).getBoundingClientRect();return{x:l.clientX-u.left,y:l.clientY-u.top}}function T(l){return{x:(l.x-f.x)/f.width,y:(l.y-f.y)/f.height}}function N(){m()&&(de.update(l=>[...l,m()]),G.set(null)),z()&&(ie.update(l=>[...l,z()]),X.set(null)),k()&&(R.update(l=>[...l,k()]),K.set(null))}function M(l){const u=F(l);if(S=u,l.button!==2){if(e()==="select"){let c=!1,_=!1;P().forEach(x=>{x.isPointInsideHandle(u,f)?(Q.set(x),x.selected=!0,x.isDraggingHandle=!0,c=!0,_=!0):(x.selected=!1,x.isDraggingHandle=!1)}),_||[...r(),...o(),...h(),...P()].forEach(x=>{x.isPointInside(u,f)?(Q.set(x),x.selected=!0,c=!0):x.selected=!1}),c||Q.set(null),g=y()!==null;return}if(e()==="character"){G.set(null),X.set(null),K.set(null);const c=T(u),_=new ht(c);ne.update(x=>[...x,_]),Q.set(_);return}if(e()==="walkable"){z()&&X.set(null),k()&&K.set(null);const c=T(u);m()?m().addPoint(c):G.set(new ct([c]))}else if(e()==="zindex"){m()&&G.set(null),k()&&K.set(null);const c=T(u);z()?z().addPoint(c):X.set(new dt([c]))}else if(e()==="interaction"){m()&&G.set(null),z()&&X.set(null);const c=T(u);k()?k().addPoint(c):K.set(new ut([c]))}}}function C(l){if(!g||!y())return;const u=F(l),c=u.x-S.x,_=u.y-S.y;y().move(c,_,f),S=u}function j(l){g=!1,y()&&y().type==="character"&&ae(Q,w(y).isDraggingHandle=!1,w(y))}function D(l){l.key==="Enter"?N():l.key==="Escape"?e()==="walkable"?G.set(null):e()==="zindex"?X.set(null):e()==="interaction"&&K.set(null):l.key==="Delete"&&y()&&(de.update(u=>u.filter(c=>c.id!==y().id)),ie.update(u=>u.filter(c=>c.id!==y().id)),R.update(u=>u.filter(c=>c.id!==y().id)),ne.update(u=>u.filter(c=>c.id!==y().id)),Q.set(null))}ce(()=>e(),()=>{e(),N()}),Ne(),be();var b=ft(),U=$(b);Pe(U,l=>Z(v,l),()=>d(v)),H(b),Pe(b,l=>Z(B,l),()=>d(B)),E("mousedown",b,M),E("mousemove",b,C),E("mouseup",b,j),E("keydown",b,D),q(a,b),we(),i()}var gt=J('<main class="svelte-12lzxqp"><!> <div class="content svelte-12lzxqp"><!> <!></div></main>');function wt(a){var t=gt(),s=$(t);tt(s,{});var i=p(s,2),e=$(i);vt(e,{});var n=p(e,2);ot(n,{}),H(i),H(t),q(a,t)}export{wt as component};
