import"../chunks/NZTpNUN0.js";import{i as L2}from"../chunks/Ddfe8oZs.js";import{w as n2,J as S2,ad as I2,aA as H2,aB as O2,O as T2,aC as B2,aD as N2,aE as j2,aF as q2,e as _,K as W2,p as x2,l as J,t as e2,a as U,m as _2,W as v2,n as S,q as v,o as I,aG as c2,aH as $2,Q as q,N as Q,f as F2,h as d,aI as U2,aJ as M2}from"../chunks/CF-fjnMp.js";import{l as z2,b as J2,w as W,e as M,g as r2,s as h2,o as Y2}from"../chunks/DiRpD8Sz.js";import{s as m2,a as T,i as o2,d as a2,b as k2}from"../chunks/DGVCnJ9z.js";const A2=[...` 	
\r\fÂ \v\uFEFF`];function G2(i,e,a){var l=""+i;if(a){for(var t in a)if(a[t])l=l?l+" "+t:t;else if(l.length)for(var s=t.length,r=0;(r=l.indexOf(t,r))>=0;){var o=r+s;(r===0||A2.includes(l[r-1]))&&(o===l.length||A2.includes(l[o]))?l=(r===0?"":l.substring(0,r))+l.substring(o+1):r=o}}return l===""?null:l}function t2(i,e,a,l,t,s){var r=i.__className;if(n2||r!==a||r===void 0){var o=G2(a,l,s);(!n2||o!==i.getAttribute("class"))&&(o==null?i.removeAttribute("class"):i.className=o),i.__className=a}else if(s&&t!==s)for(var u in s){var k=!!s[u];(t==null||k!==!!t[u])&&i.classList.toggle(u,k)}return s}function D2(i,e,a=!1){if(i.multiple){if(e==null)return;if(!I2(e))return H2();for(var l of i.options)l.selected=e.includes(i2(l));return}for(l of i.options){var t=i2(l);if(O2(t,e)){l.selected=!0;return}}(!a||e!==void 0)&&(i.selectedIndex=-1)}function X2(i){var e=new MutationObserver(()=>{D2(i,i.__value)});e.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),T2(()=>{e.disconnect()})}function K2(i,e,a=e){var l=!0;z2(i,"change",t=>{var s=t?"[selected]":":checked",r;if(i.multiple)r=[].map.call(i.querySelectorAll(s),i2);else{var o=i.querySelector(s)??i.querySelector("option:not([disabled])");r=o&&i2(o)}a(r)}),S2(()=>{var t=e();if(D2(i,t,l),l&&t===void 0){var s=i.querySelector(":checked");s!==null&&(t=i2(s),a(t))}i.__value=t,l=!1}),X2(i)}function i2(i){return"__value"in i?i.__value:i.value}const V2=Symbol("is custom element"),Q2=Symbol("is html");function u2(i){if(n2){var e=!1,a=()=>{if(!e){if(e=!0,i.hasAttribute("value")){var l=i.value;Z2(i,"value",null),i.value=l}if(i.hasAttribute("checked")){var t=i.checked;Z2(i,"checked",null),i.checked=t}}};i.__on_r=a,B2(a),J2()}}function Z2(i,e,a,l){var t=R2(i);n2&&(t[e]=i.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&i.nodeName==="LINK")||t[e]!==(t[e]=a)&&(e==="loading"&&(i[N2]=a),i.removeAttribute(e))}function R2(i){return i.__attributes??={[V2]:i.nodeName.includes("-"),[Q2]:i.namespaceURI===j2}}function f2(i,e,a=e){var l=q2();z2(i,"input",t=>{var s=t?i.defaultValue:i.value;if(s=p2(i)?C2(s):s,a(s),l&&s!==(s=e())){var r=i.selectionStart,o=i.selectionEnd;i.value=s??"",o!==null&&(i.selectionStart=r,i.selectionEnd=Math.min(o,i.value.length))}}),(n2&&i.defaultValue!==i.value||_(e)==null&&i.value)&&a(p2(i)?C2(i.value):i.value),W2(()=>{var t=e();p2(i)&&t===C2(i.value)||i.type==="date"&&!t&&!i.value||t!==i.value&&(i.value=t??"")})}function p2(i){var e=i.type;return e==="number"||e==="range"}function C2(i){return i===""?null:+i}const B=W(null),d2=W([]),l2=W([]),s2=W([]),g2=W(null),y2=W("select"),X=W(null),K=W(null),R=W([]),V=W(null);var t3=J('<div class="toolbar svelte-16pg9je"><button title="Load Background Image" class="svelte-16pg9je"><i class="material-icons">photo</i> <span>Load BG</span></button> <button title="Select"><i class="material-icons">touch_app</i> <span>Select</span></button> <button title="Create Walkable Area"><i class="material-icons">timeline</i> <span>Walkable</span></button> <button title="Create Z-Index Area"><i class="material-icons">layers</i> <span>Z-Index</span></button> <button title="Create Interaction Area"><i class="material-icons">interests</i> <span>Interaction</span></button> <button title="Create Character Point"><i class="material-icons">person_add</i> <span>Character</span></button> <button title="Export JSON" class="svelte-16pg9je"><i class="material-icons">save</i> <span>Export</span></button></div>');function e3(i,e){x2(e,!1);const[a,l]=m2(),t=()=>T(y2,"$tool",a);function s(P){y2.set(P)}function r(){const P=document.createElement("input");P.type="file",P.accept="image/png",P.onchange=N=>{const H=N.target.files[0];if(!H)return;const Z=new FileReader;Z.onload=$=>{const b=new Image;b.onload=()=>{g2.set(b)},b.src=$.target.result},Z.readAsDataURL(H)},P.click()}function o(){const P={walkable_areas:r2(d2).map(b=>({points:b.points})),z_index_areas:r2(l2).map(b=>({points:b.points,z_index:b.zIndex})),interaction_areas:r2(R).map(b=>({points:b.points,name:b.name,interaction_type:b.interactionType})),character_points:r2(s2)},N=JSON.stringify({scene:P},null,2),H=new Blob([N],{type:"application/json"}),Z=URL.createObjectURL(H),$=document.createElement("a");$.href=Z,$.download="scene.json",document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(Z)}L2();var u=t3(),k=S(u),w=v(k,2);let z;var A=v(w,2);let g;var p=v(A,2);let m;var j=v(p,2);let C;var D=v(j,2);let f;var G=v(D,2);I(u),e2((P,N,H,Z,$)=>{z=t2(w,1,"svelte-16pg9je",null,z,P),g=t2(A,1,"svelte-16pg9je",null,g,N),m=t2(p,1,"svelte-16pg9je",null,m,H),C=t2(j,1,"svelte-16pg9je",null,C,Z),f=t2(D,1,"svelte-16pg9je",null,f,$)},[()=>({active:t()==="select"}),()=>({active:t()==="walkable"}),()=>({active:t()==="zindex"}),()=>({active:t()==="interaction"}),()=>({active:t()==="character"})],v2),M("click",k,r),M("click",w,()=>s("select")),M("click",A,()=>s("walkable")),M("click",p,()=>s("zindex")),M("click",j,()=>s("interaction")),M("click",D,()=>s("character")),M("click",G,o),U(i,u),_2(),l()}var a3=J('<label class="svelte-10x0sde">Z-Index: <input type="range" min="0" max="1" step="0.01" class="svelte-10x0sde"/> <span class="svelte-10x0sde"> </span></label>'),i3=J('<label class="svelte-10x0sde">Name: <input type="text"/></label> <label class="svelte-10x0sde">Interaction Type: <select><option>Interaction</option><option>Scene Change</option></select></label>',1),l3=J('<label class="svelte-10x0sde">Relative Height: <input type="range" min="0.01" max="1" step="0.01" class="svelte-10x0sde"/> <span class="svelte-10x0sde"> </span></label>'),s3=J('<h2 class="svelte-10x0sde">Properties</h2> <p class="svelte-10x0sde"> </p> <!> <!> <!>',1),n3=J('<p class="svelte-10x0sde">No object selected</p>'),r3=J('<div class="properties-panel svelte-10x0sde"><!></div>');function o3(i,e){x2(e,!1);const[a,l]=m2(),t=()=>T(B,"$selectedObject",a);let s=Q(),r=Q(.1),o=Q(""),u=Q("interaction");function k(){t()&&t().type==="zindex"&&(a2(B,_(t).zIndex=d(s),_(t)),l2.update(C=>[...C]))}function w(){t()&&t().type==="character"&&(a2(B,_(t).relativeHeight=d(r),_(t)),s2.update(C=>[...C]))}function z(){t()&&t().type==="interaction"&&(a2(B,_(t).name=d(o),_(t)),R.update(C=>[...C]))}function A(){t()&&t().type==="interaction"&&(a2(B,_(t).interactionType=d(u),_(t)),R.update(C=>[...C]))}c2(()=>t(),()=>{t()&&t().type==="zindex"&&q(s,t().zIndex)}),c2(()=>t(),()=>{t()&&t().type==="character"&&q(r,t().relativeHeight)}),c2(()=>t(),()=>{t()&&t().type==="interaction"&&(q(o,t().name),q(u,t().interactionType))}),$2(),L2();var g=r3(),p=S(g);{var m=C=>{var D=s3(),f=v(F2(D),2),G=S(f);I(f);var P=v(f,2);{var N=E=>{var O=a3(),F=v(S(O));u2(F);var L=v(F,2),Y=S(L,!0);I(L),I(O),e2(n=>h2(Y,n),[()=>(d(s),_(()=>d(s).toFixed(2)))],v2),f2(F,()=>d(s),n=>q(s,n)),M("input",F,k),U(E,O)};o2(P,E=>{t(),_(()=>t().type==="zindex")&&E(N)})}var H=v(P,2);{var Z=E=>{var O=i3(),F=F2(O),L=v(S(F));u2(L),I(F);var Y=v(F,2),n=v(S(Y));e2(()=>{d(u),U2(()=>{})});var h=S(n);h.value=h.__value="interaction";var c=v(h);c.value=c.__value="scene_change",I(n),I(Y),f2(L,()=>d(o),x=>q(o,x)),M("input",L,z),K2(n,()=>d(u),x=>q(u,x)),M("change",n,A),U(E,O)};o2(H,E=>{t(),_(()=>t().type==="interaction")&&E(Z)})}var $=v(H,2);{var b=E=>{var O=l3(),F=v(S(O));u2(F);var L=v(F,2),Y=S(L,!0);I(L),I(O),e2(n=>h2(Y,n),[()=>(d(r),_(()=>d(r).toFixed(2)))],v2),f2(F,()=>d(r),n=>q(r,n)),M("input",F,w),U(E,O)};o2($,E=>{t(),_(()=>t().type==="character")&&E(b)})}e2(()=>h2(G,`Type: ${t(),_(()=>t().type)??""}`)),U(C,D)},j=C=>{var D=n3();U(C,D)};o2(p,C=>{t()?C(m):C(j,!1)})}I(g),U(i,g),_2(),l()}class E2{constructor(){this.id=Date.now()+Math.random(),this.selected=!1,this.type="drawable"}move(e,a){}draw(e){}isPointInside(e){return!1}}class b2 extends E2{constructor(e=[]){super(),this.points=e,this.fillColor="rgba(0, 255, 0, 0.5)",this.lineColor="#00FF00",this.type="polygon"}addPoint(e){this.points.push(e)}move(e,a,l){const t=e/l.width,s=a/l.height;this.points=this.points.map(r=>({x:r.x+t,y:r.y+s}))}isPointInside(e,a){let l=!1;for(let t=0,s=this.points.length-1;t<this.points.length;s=t++){const r=this.points[t].x*a.width+a.x,o=this.points[t].y*a.height+a.y,u=this.points[s].x*a.width+a.x,k=this.points[s].y*a.height+a.y;o>e.y!=k>e.y&&e.x<(u-r)*(e.y-o)/(k-o)+r&&(l=!l)}return l}getCenter(){if(this.points.length===0)return null;const e=this.points.reduce((a,l)=>({x:a.x+l.x,y:a.y+l.y}),{x:0,y:0});return{x:e.x/this.points.length,y:e.y/this.points.length}}draw(e,a,l=!1){if(this.points.length===0)return;const t=this.points.map(s=>({x:s.x*a.width+a.x,y:s.y*a.height+a.y}));e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)e.lineTo(t[s].x,t[s].y);this.points.length>2&&e.closePath(),this.points.length>2&&(e.fillStyle=this.fillColor,e.fill()),e.strokeStyle=this.lineColor,e.lineWidth=1,e.stroke(),this.selected&&(e.strokeStyle="#FFFF00",e.lineWidth=2,e.stroke()),(this.selected||l)&&t.forEach(s=>{e.beginPath(),e.arc(s.x,s.y,5,0,2*Math.PI),e.fillStyle="#FFFF00",e.fill()})}}class c3 extends b2{constructor(e=[]){super(e),this.type="walkable"}}class d3 extends b2{constructor(e=[]){super(e),this.zIndex=1,this.fillColor="rgba(0, 0, 255, 0.5)",this.lineColor="#0000FF",this.type="zindex"}draw(e,a,l=!1){if(super.draw(e,a,l),this.points.length>0){const t=this.points.map(o=>({x:o.x*a.width+a.x,y:o.y*a.height+a.y}));let s=t.reduce((o,u)=>o+u.x,0)/t.length,r=t.reduce((o,u)=>o+u.y,0)/t.length;e.fillStyle="#FFFFFF",e.font="16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(this.zIndex.toFixed(2),s,r)}}}class h3 extends b2{constructor(e=[]){super(e),this.type="interaction",this.name="default_name",this.interactionType="interaction",this.fillColor="rgba(255, 165, 0, 0.5)",this.lineColor="#FFA500"}draw(e,a,l=!1){if(super.draw(e,a,l),this.points.length>2){const t=this.getCenter();if(t){const s={x:t.x*a.width+a.x,y:t.y*a.height+a.y};e.fillStyle="#000000",e.font="16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(this.name,s.x,s.y)}}}}class u3 extends E2{constructor(e){super(),this.basePoint=e,this.relativeHeight=.1,this.type="character",this.characterImage=new Image;const a=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1200" height="1600" viewBox="0 0 1200 1600" id="character">
  <defs>
    <path id="path-1" d="M76.625,0 C76.96,2.046 77.135,4.146 77.135,6.287 L77.135,20.47 C77.135,41.77 59.868,59.037 38.567,59.037 C17.267,59.037 0,41.77 0,20.47 L0,6.287 C0,4.146 0.174,2.046 0.51,0 L76.625,0 Z"/>
  </defs>
  <g id="gee_me_041" fill="none" fill-rule="evenodd" stroke="none" stroke-width="1">
    <g transform="translate(368 109)">
      <g id="lower-limb" fill-rule="nonzero" transform="translate(22.627 843)">
        <polygon id="Path" fill="#F6DDD6" points="322.865 178.836 324.365 489.836 256.366 490.164 254.866 179.164"/>
        <polygon id="Path" fill="#F6DDD6" points="121.866 136.951 189.865 137.049 189.365 487.049 121.366 486.951"/>
        <path id="Path" fill="#161616" d="M12.0508263,532.05 C11.8517263,509.24 14.9783263,505.31 34.9283263,495.98 C54.8783263,486.66 73.6705263,473.71 108.185526,458.35 C108.185526,458.35 112.727526,457.49 120.122526,461.47 C126.433526,464.86 134.538526,473.18 146.752526,473.07 C160.014526,472.96 171.833526,470.17 179.176526,466.34 C182.349526,457.7 189.387526,457.64 189.387526,457.64 C189.387526,457.64 199.295526,476.38 199.459526,495.21 C199.624526,514.05 199.607104,530.42 199.607104,530.42 L12.0508263,532.05 Z"/>
        <path id="Path" fill="#FFF" d="M150.465526 483.8C157.451601 483.8 163.149529 486.110827 169.509574 490.553875L170.243474 491.075486C171.44058 491.947812 175.089011 494.683321 176.000848 495.295721 177.420582 496.249229 178.353629 496.672088 178.876498 496.716129L178.964526 496.72 178.964526 503.72C176.827382 503.72 174.857913 502.911222 172.460911 501.347062L172.098079 501.106779C170.930984 500.322945 166.665689 497.118866 165.952458 496.610931 160.464809 492.702849 155.920358 490.8 150.465526 490.8 146.146896 490.8 142.653721 491.9448 138.131238 494.57959L137.642664 494.867607C136.26591 495.68846 131.25247 498.908296 130.511747 499.36762 121.774824 504.785401 114.132463 507.697304 103.279306 508.675816 90.8643423 509.796925 82.7912863 507.536673 75.0834533 502.32728L74.4410741 501.887018C74.2236786 501.736039 74.001436 501.579787 73.7696121 501.41512L71.912675 500.075473 76.0163775 494.404527 77.4919243 495.471834 78.1290441 495.924403C78.4334801 496.138429 78.7199814 496.336245 79.0031772 496.527645 85.4149096 500.861059 91.8951322 502.675358 102.650244 501.704139 112.074118 500.85449 118.627753 498.422678 126.262133 493.763474L127.093181 493.248416C128.303262 492.482299 132.415435 489.846841 133.916683 488.939957L134.0579 488.855164C139.813785 485.423366 144.556059 483.8 150.465526 483.8ZM100.979831 454.749287C102.344368 454.138629 103.94558 454.749768 104.556239 456.114305 105.330245 457.843847 105.8891 459.742407 106.271363 461.80726L106.398234 462.527956C106.853487 465.259812 106.958366 467.692791 106.958366 471.74 106.958366 473.635503 105.06947 474.92558 103.322982 474.282845L103.164659 474.219053 89.975 468.437 92.7838352 478.556324C93.3447371 480.577954 91.4984493 482.418221 89.5066924 481.903215L89.3491874 481.857624 76.1 477.61 76.1003663 489.5C76.1003663 491.490881 74.0341895 492.78081 72.2621946 491.959375L72.1110849 491.883763 63.107 487.039 63.1075663 495.96C63.1075663 497.399578 61.9837802 498.576682 60.5656194 498.6619L60.4007263 498.66684C58.9611482 498.66684 57.7840444 497.543054 57.6988263 496.124893L57.6938863 495.96 57.6938863 482.51C57.6938863 480.519119 59.760063 479.22919 61.5320579 480.050625L61.6831676 480.126237 70.686 484.97 70.6866863 473.9C70.6866863 472.122852 72.3630637 470.844318 74.0560333 471.275291L74.2198651 471.322376 86.226 475.171 83.2362173 464.393676C82.6405309 462.246674 84.7406663 460.364481 86.7854671 461.131614L86.931393 461.190947 101.473 467.566 101.457517 467.230183C101.380071 465.725082 101.241322 464.453432 101.004534 463.105337L100.948134 462.79274C100.639661 461.126471 100.200406 459.634221 99.6148135 458.325695 99.004155 456.961158 99.6152943 455.359946 100.979831 454.749287Z"/>
        <path id="Path" fill="#393A40" d="M19.6002263 497.73C25.7210263 495.53 32.2031263 493.86 44.6306263 491.06L39.3486263 506.17 39.4989263 523.39 4.12652625 523.690154C2.68292625 523.71.10362625 521.79 1.33532625 514.03 2.87482625 504.34 10.9031263 500.87 19.6002263 497.73ZM175.464526 499.22C179.935526 494.52 193.965526 489.28 198.965526 490.77L199.964526 508.66 199.963526 523.68C171.197526 523.69 168.963526 523.69 168.963526 523.69 170.502526 513.99 166.964526 508.17 175.464526 499.22Z"/>
        <path id="Path" fill="#D3D5E0" d="M200.384084,532.59 L200.172526,519.3 L122.369526,522.52 L40.5670263,521.76 L1.02052625,518.88 L0.0542262503,527.54 C-0.49197375,532.44 3.15272625,536.81 8.06932625,537.15 L40.7644263,539.39 L196.120526,536.99 C198.512526,536.95 200.421526,534.98 200.384084,532.59 Z"/>
        <polygon id="Path" fill="#000" points="198.431 522.571 198.496 524.569 122.964 527.06 40.397 527.068 2.897 524.578 3.029 522.582 40.463 525.07 122.931 525.061"/>
        <path id="Path" fill="#161616" d="M424.776526,532.05 C424.975526,509.24 421.849526,505.31 401.899526,495.98 C381.949526,486.66 363.157526,473.71 328.642526,458.35 C328.642526,458.35 324.099526,457.49 316.704526,461.47 C310.394526,464.86 302.289526,473.18 290.075526,473.07 C276.812526,472.96 264.994526,470.17 257.651526,466.34 C254.478526,457.7 247.440526,457.64 247.440526,457.64 C247.440526,457.64 237.532526,476.38 237.367526,495.21 C237.203526,514.05 237.220943,530.42 237.220943,530.42 L424.776526,532.05 Z"/>
        <path id="Path" fill="#FFF" d="M286.362526 483.8C292.087322 483.8 296.716735 485.323491 302.233441 488.538725L302.770152 488.855164C304.267354 489.747831 309.354184 493.014801 310.00532 493.418572 317.882318 498.303112 324.524084 500.833767 334.178306 501.704184 344.93292 502.675358 351.413143 500.861059 357.824875 496.527645L358.400009 496.133389 359.90725 495.060214 360.811675 494.404527 364.915378 500.075473 363.413954 501.161416 362.717299 501.656202C362.38216 501.891758 362.063252 502.111916 361.744599 502.32728 354.036766 507.536673 345.96371 509.796925 333.549244 508.675861 322.936782 507.71905 315.394475 504.913864 306.897193 499.725099L305.872708 499.088106C304.413634 498.162977 300.395263 495.588963 299.185389 494.867607 294.422791 492.028031 290.835394 490.8 286.362526 490.8 281.072993 490.8 276.6395 492.589272 271.371925 496.261172L270.687558 496.746951C269.646003 497.507164 266.086392 500.174969 264.856764 501.020518L264.729973 501.106779C262.28873 502.746345 260.30478 503.633197 258.182915 503.713941L257.863526 503.72 257.863526 496.72C258.338403 496.72 259.218958 496.350114 260.5817 495.45851L260.827204 495.295721C261.774112 494.659767 265.672169 491.734248 266.711533 490.983329L266.814958 490.909069C273.379525 486.23405 279.192608 483.8 286.362526 483.8ZM332.270623 456.11473C332.881047 454.750088 334.482154 454.138673 335.846796 454.749097 337.211438 455.359521 337.822853 456.960628 337.212429 458.32527 336.62708 459.633856 336.188007 461.126177 335.879663 462.79252 335.6083 464.259006 335.453865 465.609177 335.370498 467.230093L335.354 467.566 349.89561 461.190969C351.936221 460.296275 354.097715 462.107737 353.628837 464.2408L353.590835 464.393676 350.6 475.171 362.608232 471.322361C364.300536 470.779872 366.029765 471.985915 366.136189 473.729617L366.141366 473.9 366.141 484.97 375.1451 480.126229C376.898357 479.183008 379.013222 480.391435 379.129361 482.341103L379.134366 482.51 379.134366 495.96C379.134366 497.454946 377.922473 498.66684 376.427526 498.66684 374.987948 498.66684 373.810844 497.543054 373.725626 496.124893L373.720686 495.96 373.72 487.039 364.716952 491.883771C362.963695 492.826992 360.848831 491.618565 360.732691 489.668897L360.727686 489.5 360.727 477.61 347.47782 481.857639C345.479982 482.498071 343.568125 480.726068 344.003896 478.715508L344.043217 478.556324 346.851 468.437 333.663443 474.219031C331.927445 474.980169 329.987449 473.768228 329.874833 471.910616L329.869686 471.74 329.875581 470.234479C329.905732 466.734958 330.061076 464.484034 330.556353 461.80748 330.938425 459.742701 331.497001 457.844213 332.270623 456.11473Z"/>
        <path id="Path" fill="#393A40" d="M417.227526 497.73C411.106526 495.53 404.624526 493.86 392.197526 491.06L397.479526 506.17 397.328526 523.39 432.701526 523.690154C434.144526 523.71 436.724526 521.79 435.492526 514.03 433.952526 504.34 425.924526 500.87 417.227526 497.73ZM261.363526 499.22C256.892526 494.52 242.862526 489.28 237.862526 490.77L236.863526 508.66 236.864526 523.68C265.629526 523.69 267.864526 523.69 267.864526 523.69 266.324526 513.99 269.863526 508.17 261.363526 499.22Z"/>
        <path id="Path" fill="#D3D5E0" d="M236.443969,532.59 L236.655526,519.3 L314.458526,522.52 L396.260526,521.76 L435.807526,518.88 L436.773526,527.54 C437.319526,532.44 433.675526,536.81 428.758526,537.15 L396.063526,539.39 L240.707526,536.99 C238.315526,536.95 236.406526,534.98 236.443969,532.59 Z"/>
        <polygon id="Path" fill="#000" points="238.397 522.571 313.865 525.06 396.298 525.072 433.798 522.582 433.931 524.578 396.364 527.07 313.832 527.059 238.332 524.569"/>
        <polygon id="Path" fill="#252424" points="211.366 0 341.366 0 332.366 436 238.195 436"/>
        <polygon id="Path" fill="#252424" points="213.366 0 83.366 0 103.366 436 197.537 436"/>
      </g>
      <g id="upper-limb" fill-rule="nonzero" transform="translate(0 210)">
        <path id="Combined-Shape" fill="#17100F" d="M274.327661,270.020584 C187.875182,343.203322 27.4778536,438.70047 14.2025817,445.5 C-6.29743833,456 2.14498167,358.951 6.20298167,339 C12.2032817,309.5 28.7015817,267 36.7017817,229.5 C42.2206817,203.631 59.2025817,65.667 65.7025817,9.5 L89.2027817,8.52651283e-14 L292.56356,196.759008 C305.194912,171.527588 318.706448,146.047963 323.699782,134.5 L381.200782,86 L404.700782,83 C405.700782,100.667 404.700782,140.992 404.700782,150.5 C404.700782,178.5 415.700782,217 419.200782,238 C422.700782,259 439.201782,365 356.201782,306.5 C339.086518,294.436857 292.842942,283.056273 274.327661,270.020584 Z"/>
        <path id="Path" fill="#252424" d="M234.991782,715 C298.504782,715 349.991782,691.495 349.991782,662.5 C349.991782,633.505 298.504782,610 234.991782,610 C171.478782,610 119.991782,633.505 119.991782,662.5 C119.991782,691.495 171.478782,715 234.991782,715 Z"/>
        <path id="Path" fill="#FAF3EA" d="M165.992782,608.967 L165.992782,255 L301.992782,255 L301.992782,608.967 C301.992782,608.967 254.317782,618 233.992782,618 C213.667782,618 165.992782,608.967 165.992782,608.967 Z"/>
        <path id="Path" fill="#EADFD2" d="M193.992782,209 L208.501782,216.254 C224.548782,224.278 243.436782,224.278 259.483782,216.254 L273.992782,209 L273.992782,259 C273.992782,281.091 256.083782,299 233.992782,299 C211.901782,299 193.992782,281.091 193.992782,259 L193.992782,209 Z"/>
        <polygon id="Path" fill="#EADFD2" points="166.993 648 166.993 589 302.993 589 302.993 648"/>
        <path id="Path" fill="#2B4166" d="M34.7574817 331.849C41.1700817 284.005 85.5098817 250.674 133.251782 257.809 179.983782 264.793 212.457782 307.993 206.180782 354.825L177.199782 571.055C170.786782 618.899 126.446782 652.231 78.7055817 645.096 31.9736817 638.111-.50081833 594.911 5.77608167 548.079L34.7574817 331.849ZM433.501782 315.312C427.221782 267.35 382.819782 233.866 334.978782 241.016 288.349782 247.984 255.896782 291.02 262.017782 337.767L292.430782 570.025C298.711782 617.988 343.113782 651.471 390.954782 644.322 437.582782 637.353 470.035782 594.318 463.914782 547.57L433.501782 315.312Z"/>
        <path id="Path" fill="#3C557C" d="M55.8755817,781.144 L98.8237817,247.729 L191.492782,241 L223.992782,430.5 C215.402782,543.883 203.616782,799.18 203.616782,812.93 C203.616782,826.67 98.8237817,795.46 55.8755817,781.144 Z"/>
        <polygon id="Path" fill="#62789C" points="128.293 598.237 88.426 677.032 76.181 661.44 116.458 592.777"/>
        <polygon id="Path" fill="#62789C" points="224.493 429.5 192.493 229.5 121.993 238.5 207.493 426.5 215.493 567"/>
        <path id="Path" fill="#3C557C" d="M413.203782,775.132 L370.492782,247.5 L272.992782,243.5 L245.492782,433 C254.082782,546.383 265.461782,793.17 265.461782,806.91 C265.461782,820.66 370.255782,789.448 413.203782,775.132 Z"/>
        <polygon id="Path" fill="#62789C" points="329.024 597.237 368.891 676.032 381.136 660.44 340.859 591.777"/>
        <path id="Path" fill="#62789C" d="M245.492782,434 L274.992782,232 C274.992782,232 326.825782,237 338.492782,237 L268.992782,442.5 L254.992782,596 L245.492782,434 Z"/>
        <path id="Path" fill="#FFF" d="M335.623395 236.202499C336.063843 234.893923 337.481706 234.190166 338.790282 234.630613 340.046515 235.053443 340.745347 236.37706 340.409564 237.640017L340.362168 237.797501 271.452 442.53 257.480197 581.250531C257.347367 582.569342 256.212338 583.545065 254.906332 583.500189L254.742251 583.487415C253.42344 583.354585 252.447717 582.219556 252.494185 580.91355L252.505367 580.749469 266.533581 441.469338 335.623395 236.202499ZM128.062222 235.679643C129.290324 235.187123 130.678217 235.738062 131.244074 236.912721L131.313139 237.06944 208.464781 429.447561 216.48853 566.854263C216.569019 568.232627 215.516883 569.41526 214.138519 569.495749 212.81529 569.573017 211.672445 568.60646 211.511924 567.309523L211.497033 567.145737 203.521 430.553 126.672424 238.93056C126.179904 237.702458 126.730843 236.314565 127.905503 235.748708L128.062222 235.679643Z"/>
        <circle id="Oval" cx="193.74" cy="450.874" r="9.878" fill="#536F9D"/>
        <circle id="Oval" cx="187.727" cy="584.872" r="9.878" fill="#536F9D"/>
        <circle id="Oval" cx="192.021" cy="517.873" r="9.878" fill="#536F9D"/>
        <circle id="Oval" cx="179.996" cy="649.294" r="9.878" fill="#536F9D"/>
        <circle id="Oval" cx="173.984" cy="705.127" r="9.878" fill="#536F9D"/>
      </g>
      <g id="head" transform="translate(37.993)">
        <rect id="Rectangle" width="80" height="116" x="156" y="383" fill="#EBBAAA" fill-rule="nonzero" rx="40"/>
        <path id="Path" fill="#DE8E7C" fill-rule="nonzero" d="M354 290C376.091 290 394 272.091 394 250 394 227.909 376.091 210 354 210 331.909 210 314 227.909 314 250 314 272.091 331.909 290 354 290ZM40 290C17.9086 290 0 272.091 0 250 0 227.909 17.9086 210 40 210 62.091 210 80 227.909 80 250 80 272.091 62.091 290 40 290Z" opacity=".5"/>
        <path id="Path" fill="#F4D5CC" fill-rule="nonzero" d="M45,165 C45,82.1573 112.157,15 195,15 C277.843,15 345,82.1573 345,165 L345,271 C345,353.843 277.843,421 195,421 C112.157,421 45,353.843 45,271 L45,165 Z"/>
        <path id="Path" fill="#FFF" fill-opacity=".75" fill-rule="nonzero" d="M308 189 228 189C220.267861 189 214 195.267861 214 203L214 228C214 257.823139 238.176861 282 268 282L293 282C309.016139 282 322 269.016139 322 253L322 203C322 195.267861 315.732139 189 308 189ZM228 197 308 197C311.313861 197 314 199.686139 314 203L314 253C314 264.597861 304.597861 274 293 274L268 274C242.595139 274 222 253.404861 222 228L222 203C222 199.686139 224.686139 197 228 197ZM164 189 84 189C76.267861 189 70 195.267861 70 203L70 253C70 269.016139 82.983861 282 99 282L124 282C153.823139 282 178 257.823139 178 228L178 203C178 195.267861 171.732139 189 164 189ZM84 197 164 197C167.313861 197 170 199.686139 170 203L170 228C170 253.404861 149.404861 274 124 274L99 274C87.402139 274 78 264.597861 78 253L78 203C78 199.686139 80.686139 197 84 197Z"/>
        <rect id="Rectangle" width="50" height="8" x="171" y="203" fill="#FFF" fill-opacity=".75" fill-rule="nonzero"/>
        <path id="Path" fill="#000" fill-rule="nonzero" d="M257.537 203.407C264.062457 203.407 269.371393 208.615544 269.5332 215.102025L269.537 215.407 269.537 243.297C269.537 249.924417 264.164417 255.297 257.537 255.297 251.011543 255.297 245.702607 250.088456 245.5408 243.601975L245.537 243.297 245.537 215.407C245.537 208.779583 250.909583 203.407 257.537 203.407ZM132.46 203.407C138.985457 203.407 144.294393 208.615544 144.4562 215.102025L144.46 215.407 144.46 243.297C144.46 249.924417 139.087417 255.297 132.46 255.297 125.934543 255.297 120.625607 250.088456 120.4638 243.601975L120.46 243.297 120.46 215.407C120.46 208.779583 125.832583 203.407 132.46 203.407Z"/>
        <path id="Path" fill="#393939" d="M231.135,324.603 L231.135,338.469 C231.135,359.769 213.868,377.037 192.567,377.037 C171.267,377.037 154,359.769 154,338.469 L154,324.603 L231.135,324.603 Z"/>
        <g id="Clipped" transform="translate(154 318)">
          <mask id="mask-2" fill="#fff">
            <use xlink:href="#path-1"/>
          </mask>
          <g id="Group" fill-rule="nonzero" mask="url(#mask-2)">
            <g transform="translate(0 4)">
              <ellipse id="Oval" cx="36.51" cy="55.942" fill="#FF6C6C" rx="23.258" ry="12.667" transform="matrix(-1 0 0 1 73.02 0)"/>
              <rect id="Rectangle" width="77.135" height="15.907" x="0" y=".604" fill="#FFF" transform="matrix(-1 0 0 1 77.135 0)"/>
            </g>
          </g>
        </g>
        <path id="Path" fill="#311E1C" fill-rule="nonzero" d="M248.627744,8.50069281 L249.844242,8.93831947 C284.147488,20.6760081 328.546255,52.8497108 345.5,97.0003 C363.39,143.589 375,201.500003 375,251.500003 C375,281.000003 351,434.000003 348.5,459.000003 L348.284369,461.233544 C346.083377,484.894136 347.025041,503.684072 348.455153,553.43516 L348.588124,558.140103 C349.9956,609.26242 349.78,652.0355 339,655.000003 C319,660.500003 256.5,652.500003 248,651.000003 C239.5,649.500003 245,614.8 245,595.500003 C245,569.000003 263,479.500003 272.5,445.000003 C279.801,418.487 316,334.000003 318.5,327.000003 L320.032584,322.697027 C329.710977,295.38143 338.575,266.35 330.5,206.500003 L330.494008,204.410278 C330.433477,193.835938 329.905312,181.53125 328.5,174.500003 C324.716,155.574 306.501,130.000003 281.501,106.000003 C251.952,77.6338 204.499,71.5005 199.999,64.5005 C199.583956,63.0775928 199.198554,61.4973913 198.855284,59.7941242 L198.742925,60.4651483 C198.202418,63.5241165 197.436781,65.5553803 196.493,66.0124 C183.493,75.0124 132.493,77.5124 105.556,109.071 C78.241,141.073 59.493,174.013 58.493,206.513 L58.4262723,208.910897 C57.7562145,235.659579 59.1317779,274.414371 56.1551265,299.072101 L56.4006911,299.023289 C56.4364191,299.015395 56.4695305,299.007629 56.5,299.000003 C59.333,311.500003 60.574,330.148 70,349.000003 C77.5,364.000003 91,378.833 97.5,385.500003 L98.2100913,388.299634 C104.123347,411.787187 115.428,460.816 118.5,490.000003 C122.5,528.000003 118.5,647.000003 109.5,647.000003 C88.607,647.000003 73.906,650.000003 70,637.500003 C62.998518,615.095258 67.326276,574.389436 61.4241054,538.162032 L61.3458725,541.054682 C60.1254109,588.853741 61.6639645,663.145173 58.493,679.000003 C55.762,692.658 8,687.513 8,670.500003 L8.00526151,666.053287 C8.17638288,593.804862 12.484506,540.26678 15.4934,510.513 C19.9934,466.013 15.4934,415.513 15.4934,376.513 C15.4934,337.513 19.4933,228.013 24.9933,193.513 C36.7127,120.000003 62.493,69.0126 88.493,44.5126 C103.397953,30.4675484 128.98356,16.0937824 151.214317,8.83303593 L150.852,9.01179 C170.0184,-0.57141 210.05701,-4.84168392 247.494107,8.10314365 L248.627744,8.50069281 Z"/>
        <path id="Path" fill="#393939" fill-rule="nonzero" d="M237.162324 161.600435 293.256324 162.905435C298.225542 163.021041 302.160172 167.143106 302.044565 172.112324 301.931023 176.992806 297.952833 180.875319 293.103056 180.902901L292.837676 180.900565 236.743676 179.595565C231.774458 179.479959 227.839828 175.357894 227.955435 170.388676 228.068977 165.508194 232.047167 161.625681 236.896944 161.598099L237.162324 161.600435ZM148.732756 161.304178C153.70046 161.135596 157.864241 165.026053 158.032822 169.993756 158.198393 174.872751 154.448597 178.976278 149.608323 179.280987L149.343244 179.293822 93.2662436 181.196822C88.2985405 181.365404 84.1347592 177.474947 83.9661778 172.507244 83.8006068 167.628249 87.5504027 163.524722 92.3906769 163.220013L92.6557564 163.207178 148.732756 161.304178Z"/>
        <path id="Path" fill="#EBBAAA" fill-rule="nonzero" d="M185.927572,248.285048 L200.072428,257.714952 C195.265005,264.926086 191.5,275.750474 191.5,283.625 C191.5,291.218019 194.241995,294.409707 202.636755,294.498108 L203,294.5 L203,311.5 C184.456881,311.5 174.5,300.298509 174.5,283.625 C174.5,272.329891 179.198935,258.618754 185.577977,248.815839 L185.927572,248.285048 Z"/>
      </g>
    </g>
  </g>
</svg>`;this.characterImage.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a),this.isDraggingHandle=!1}move(e,a,l){const t=e/l.width,s=a/l.height;this.basePoint.x+=t,this.basePoint.y+=s}moveHeight(e,a){const l=e/a.height;this.relativeHeight-=l,this.relativeHeight=Math.max(.01,this.relativeHeight)}isPointInside(e,a){const l={x:this.basePoint.x*a.width+a.x,y:this.basePoint.y*a.height+a.y};return Math.sqrt(Math.pow(e.x-l.x,2)+Math.pow(e.y-l.y,2))<10}isPointInsideHandle(e,a){const l={x:this.basePoint.x*a.width+a.x,y:this.basePoint.y*a.height+a.y},t=this.relativeHeight*a.height,s={x:l.x,y:l.y-t};return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))<10}draw(e,a){const l={x:this.basePoint.x*a.width+a.x,y:this.basePoint.y*a.height+a.y},t=this.relativeHeight*a.height,s=this.characterImage.width/this.characterImage.height,r=t*s,o=l.x-r/2,u=l.y-t;e.drawImage(this.characterImage,o,u,r,t),e.fillStyle="red",e.beginPath(),e.arc(l.x,l.y,5,0,Math.PI*2),e.fill(),e.fillStyle="blue",e.beginPath(),e.arc(l.x,u,5,0,Math.PI*2),e.fill(),this.selected&&(e.strokeStyle="#FFFF00",e.lineWidth=2,e.strokeRect(o,u,r,t))}toJSON(){return{basePoint:this.basePoint,relativeHeight:this.relativeHeight}}}var f3=J('<div class="canvas-container svelte-14wctm0" tabindex="0"><canvas class="svelte-14wctm0"></canvas></div>');function p3(i,e){x2(e,!1);const[a,l]=m2(),t=()=>T(y2,"$tool",a),s=()=>T(g2,"$backgroundImage",a),r=()=>T(d2,"$walkableAreas",a),o=()=>T(l2,"$zIndexAreas",a),u=()=>T(R,"$interactionAreas",a),k=()=>T(s2,"$characterPoints",a),w=()=>T(X,"$draftWalkableArea",a),z=()=>T(K,"$draftZIndexArea",a),A=()=>T(V,"$draftInteractionArea",a),g=()=>T(B,"$selectedObject",a);let p=Q(),m,j=Q(),C=!1,D={x:0,y:0},f={x:0,y:0,width:0,height:0};Y2(()=>{m=d(p).getContext("2d"),G(),window.addEventListener("resize",G);const n=new Image;return n.src="/example_background.png",n.onload=()=>{g2.set(n)},N(),()=>{window.removeEventListener("resize",G)}});function G(){M2(p,d(p).width=d(j).clientWidth),M2(p,d(p).height=d(j).clientHeight),N()}function P(){if(!s())return;const n=s(),h=d(p).width/d(p).height,c=n.width/n.height;let x,y,w2,P2;h>c?(y=d(p).height*.9,x=y*c):(x=d(p).width*.9,y=x/c),w2=(d(p).width-x)/2,P2=(d(p).height-y)/2,f={x:w2,y:P2,width:x,height:y}}function N(){m&&(m.clearRect(0,0,d(p).width,d(p).height),P(),s()&&m.drawImage(s(),f.x,f.y,f.width,f.height),r().forEach(n=>n.draw(m,f)),o().forEach(n=>n.draw(m,f)),u().forEach(n=>n.draw(m,f)),k().forEach(n=>n.draw(m,f)),w()&&w().draw(m,f,!0),z()&&z().draw(m,f,!0),A()&&A().draw(m,f,!0),requestAnimationFrame(N))}function H(n){const h=d(p).getBoundingClientRect();return{x:n.clientX-h.left,y:n.clientY-h.top}}function Z(n){return{x:(n.x-f.x)/f.width,y:(n.y-f.y)/f.height}}function $(){w()&&(d2.update(n=>[...n,w()]),X.set(null)),z()&&(l2.update(n=>[...n,z()]),K.set(null)),A()&&(R.update(n=>[...n,A()]),V.set(null))}function b(n){const h=H(n);if(D=h,n.button!==2){if(t()==="select"){let c=!1,x=!1;k().forEach(y=>{y.isPointInsideHandle(h,f)?(B.set(y),y.selected=!0,y.isDraggingHandle=!0,c=!0,x=!0):(y.selected=!1,y.isDraggingHandle=!1)}),x||[...r(),...o(),...u(),...k()].forEach(y=>{y.isPointInside(h,f)?(B.set(y),y.selected=!0,c=!0):y.selected=!1}),c||B.set(null),C=g()!==null;return}if(t()==="character"){X.set(null),K.set(null),V.set(null);const c=Z(h),x=new u3(c);s2.update(y=>[...y,x]),B.set(x);return}if(t()==="walkable"){z()&&K.set(null),A()&&V.set(null);const c=Z(h);w()?w().addPoint(c):X.set(new c3([c]))}else if(t()==="zindex"){w()&&X.set(null),A()&&V.set(null);const c=Z(h);z()?z().addPoint(c):K.set(new d3([c]))}else if(t()==="interaction"){w()&&X.set(null),z()&&K.set(null);const c=Z(h);A()?A().addPoint(c):V.set(new h3([c]))}}}function E(n){if(!C||!g())return;const h=H(n),c=h.x-D.x,x=h.y-D.y;g().move(c,x,f),D=h}function O(n){C=!1,g()&&g().type==="character"&&a2(B,_(g).isDraggingHandle=!1,_(g))}function F(n){n.key==="Enter"?$():n.key==="Escape"?t()==="walkable"?X.set(null):t()==="zindex"?K.set(null):t()==="interaction"&&V.set(null):n.key==="Delete"&&g()&&(d2.update(h=>h.filter(c=>c.id!==g().id)),l2.update(h=>h.filter(c=>c.id!==g().id)),R.update(h=>h.filter(c=>c.id!==g().id)),s2.update(h=>h.filter(c=>c.id!==g().id)),B.set(null))}c2(()=>t(),()=>{t(),$()}),$2(),L2();var L=f3(),Y=S(L);k2(Y,n=>q(p,n),()=>d(p)),I(L),k2(L,n=>q(j,n),()=>d(j)),M("mousedown",L,b),M("mousemove",L,E),M("mouseup",L,O),M("keydown",L,F),U(i,L),_2(),l()}var C3=J('<main class="svelte-12lzxqp"><!> <div class="content svelte-12lzxqp"><!> <!></div></main>');function _3(i){var e=C3(),a=S(e);e3(a,{});var l=v(a,2),t=S(l);p3(t,{});var s=v(t,2);o3(s,{}),I(l),I(e),U(i,e)}export{_3 as component};
